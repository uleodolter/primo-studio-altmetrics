(()=>{"use strict";class t{constructor(t,e,i,r,a,n,l){this.angularLoad=t,this.studioConfig=e,this.$http=i,this.$scope=r,this.$element=a,this.$timeout=n,this.$window=l}getConfigApiKey(){return this.studioConfig[0].apikey||""}getConfigISBN(){return this.studioConfig[0].isbn||""}getConfigBadgeType(){return this.studioConfig[0].badgetype||"medium-donut"}$onInit(){const t=this;t.embed_js="",t.altmetric_id="",t.altmetric_badge_type=t.getConfigBadgeType(),t.altmetric_key=t.getConfigApiKey(),t.parentElement=t.$element.parent().parent()[0],t.api="doi";try{t.doi=t.parentCtrl.item.pnx.addata.doi[0]||""}catch(e){try{t.getConfigISBN()&&(t.doi=t.parentCtrl.item.pnx.addata.isbn[0]||"",t.api="isbn")}catch(t){return}}t.doi&&t.$timeout((()=>{t.$http.get("https://api.altmetric.com/v1/"+t.api+"/"+t.doi).then((e=>{t.altmetric_id=e.data.altmetric_id,t.embed_js="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js?"+Date.now(),t.angularLoad.loadScript(t.embed_js).then((()=>{t.parentCtrl.services.splice(t.parentCtrl.services.length,0,{scrollId:"altmetrics",serviceName:"altmetrics",title:"brief.results.tabs.Altmetrics"})}),(t=>{console.log("altmetric loadScript failed: "+t)}))}),(t=>{console.log("altmetric api failed: "+t)}))}),3e3);let e=t.$scope.$watch((()=>t.parentElement.querySelector('h4[translate="brief.results.tabs.Altmetrics"]')),((i,r)=>{if(i){const r=i.parentElement.parentElement.parentElement.parentElement.children[1];r&&r.appendChild&&r.appendChild(t.$element[0]),e()}}))}$onDestroy(){const t=this;let e=null;t.$window._altmetric&&delete t.$window._altmetric,t.embed_js&&(e=document.body.querySelector('[src="'+t.embed_js+'"]'),e&&e.remove(),t.embed_js=""),document.body.querySelectorAll("script").forEach((t=>{t.src.startsWith("https://api.altmetric.com/v1/id/")&&t.parentNode.removeChild(t)})),e=document.head.querySelector('link[id="altmetric-embed-css"]'),e&&e.remove(),e=document.head.querySelector('script[id="altmetric-embed-js"]'),e&&e.remove()}}t.$inject=["angularLoad","primoStudioAltmetricsStudioConfig","$http","$scope","$element","$timeout","$window"];const e={selector:"primoStudioAltmetrics",controller:t,bindings:{parentCtrl:"<"},template:'<div id="altmetric_badge" ng-if="$ctrl.altmetric_id" class="altmetric-embed" data-hide-no-mentions="true" data-link-target="new" data-badge-type="{{$ctrl.altmetric_badge_type}}" data-badge-details="right" data-altmetric-id="{{$ctrl.altmetric_id}}"> </div> '},i=angular.module("primoStudioAltmetrics",[]).component(e.selector,e).name;app.requires.push(i)})();